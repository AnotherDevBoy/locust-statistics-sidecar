version: '3.4'
services:
  standalone:
    image: locustio/locust:1.0.3
    ports:
     - "8089:8089"
    container_name: standalone
    volumes:
      - ./locustfile:/mnt/locust
    environment:
      - LOCUST_LOCUSTFILE=/mnt/locust/locustfile.py
      - LOCUST_HOST=https://httpbin.org
  start_dependencies:
    image: dadarek/wait-for-dependencies
    depends_on:
      - standalone
    command: standalone:8089
  sidecar:
    build:
      context: ..
    depends_on:
      - start_dependencies
    environment:
      - LOCUST_URL=http://standalone:8089
      - POLL_INTERVAL_SECONDS=5
    env_file:
    - env.list
